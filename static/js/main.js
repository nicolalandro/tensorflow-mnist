"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),Main=function(){function t(){_classCallCheck(this,t),this.canvas=document.getElementById("main"),this.input=document.getElementById("input"),this.canvas.width=449,this.canvas.height=449,this.ctx=this.canvas.getContext("2d"),this.canvas.addEventListener("mousedown",this.onMouseDown.bind(this)),this.canvas.addEventListener("mouseup",this.onMouseUp.bind(this)),this.canvas.addEventListener("mousemove",this.onMouseMove.bind(this)),this.initialize()}return _createClass(t,[{key:"initialize",value:function(){this.ctx.fillStyle="#FFFFFF",this.ctx.fillRect(0,0,449,449),this.ctx.lineWidth=1,this.ctx.strokeRect(0,0,449,449),this.ctx.lineWidth=.05;for(var t=0;t<27;t++)this.ctx.beginPath(),this.ctx.moveTo(16*(t+1),0),this.ctx.lineTo(16*(t+1),449),this.ctx.closePath(),this.ctx.stroke(),this.ctx.beginPath(),this.ctx.moveTo(0,16*(t+1)),this.ctx.lineTo(449,16*(t+1)),this.ctx.closePath(),this.ctx.stroke();this.drawInput(),$("#output td").text("").removeClass("success")}},{key:"onMouseDown",value:function(t){this.canvas.style.cursor="default",this.drawing=!0,this.prev=this.getPosition(t.clientX,t.clientY)}},{key:"onMouseUp",value:function(){this.drawing=!1,this.drawInput()}},{key:"onMouseMove",value:function(t){if(this.drawing){var e=this.getPosition(t.clientX,t.clientY);this.ctx.lineWidth=16,this.ctx.lineCap="round",this.ctx.beginPath(),this.ctx.moveTo(this.prev.x,this.prev.y),this.ctx.lineTo(e.x,e.y),this.ctx.stroke(),this.ctx.closePath(),this.prev=e}}},{key:"getPosition",value:function(t,e){var i=this.canvas.getBoundingClientRect();return{x:t-i.left,y:e-i.top}}},{key:"drawInput",value:function(){var t=this.input.getContext("2d"),e=new Image;e.onload=function(){var i=[],n=document.createElement("canvas").getContext("2d");n.drawImage(e,0,0,e.width,e.height,0,0,28,28);for(var s=n.getImageData(0,0,28,28).data,a=0;a<28;a++)for(var o=0;o<28;o++){var c=4*(28*a+o);i[28*a+o]=(s[c+0]+s[c+1]+s[c+2])/3,t.fillStyle="rgb("+[s[c+0],s[c+1],s[c+2]].join(",")+")",t.fillRect(5*o,5*a,5,5)}255!==Math.min.apply(Math,i)&&$.ajax({url:"/api/mnist",method:"POST",contentType:"application/json",data:JSON.stringify(i),success:function(t){for(var e=0;e<4;e++){for(var i=0,n=0,s=0;s<10;s++){var a=Math.round(1e3*t.results[e][s]);a>i&&(i=a,n=s);for(var o=String(a).length,c=0;c<3-o;c++)a="0"+a;var r="0."+a;a>999&&(r="1.000"),$("#output tr").eq(s+1).find("td").eq(e).text(r)}for(var h=0;h<10;h++)h===n?$("#output tr").eq(h+1).find("td").eq(e).addClass("success"):$("#output tr").eq(h+1).find("td").eq(e).removeClass("success")}}})},e.src=this.canvas.toDataURL()}}]),t}();$(function(){var t=new Main;$("#clear").click(function(){t.initialize()})});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1haW4uanMiXSwibmFtZXMiOlsiX2NsYXNzQ2FsbENoZWNrIiwidCIsImUiLCJUeXBlRXJyb3IiLCJfY3JlYXRlQ2xhc3MiLCJpIiwibGVuZ3RoIiwibiIsImVudW1lcmFibGUiLCJjb25maWd1cmFibGUiLCJ3cml0YWJsZSIsIk9iamVjdCIsImRlZmluZVByb3BlcnR5Iiwia2V5IiwicHJvdG90eXBlIiwiTWFpbiIsInRoaXMiLCJjYW52YXMiLCJkb2N1bWVudCIsImdldEVsZW1lbnRCeUlkIiwiaW5wdXQiLCJ3aWR0aCIsImhlaWdodCIsImN0eCIsImdldENvbnRleHQiLCJhZGRFdmVudExpc3RlbmVyIiwib25Nb3VzZURvd24iLCJiaW5kIiwib25Nb3VzZVVwIiwib25Nb3VzZU1vdmUiLCJpbml0aWFsaXplIiwidmFsdWUiLCJmaWxsU3R5bGUiLCJmaWxsUmVjdCIsImxpbmVXaWR0aCIsInN0cm9rZVJlY3QiLCJiZWdpblBhdGgiLCJtb3ZlVG8iLCJsaW5lVG8iLCJjbG9zZVBhdGgiLCJzdHJva2UiLCJkcmF3SW5wdXQiLCIkIiwidGV4dCIsInJlbW92ZUNsYXNzIiwic3R5bGUiLCJjdXJzb3IiLCJkcmF3aW5nIiwicHJldiIsImdldFBvc2l0aW9uIiwiY2xpZW50WCIsImNsaWVudFkiLCJsaW5lQ2FwIiwieCIsInkiLCJnZXRCb3VuZGluZ0NsaWVudFJlY3QiLCJsZWZ0IiwidG9wIiwiSW1hZ2UiLCJvbmxvYWQiLCJjcmVhdGVFbGVtZW50IiwiZHJhd0ltYWdlIiwicyIsImdldEltYWdlRGF0YSIsImRhdGEiLCJhIiwibyIsImMiLCJqb2luIiwiTWF0aCIsIm1pbiIsImFwcGx5IiwiYWpheCIsInVybCIsIm1ldGhvZCIsImNvbnRlbnRUeXBlIiwiSlNPTiIsInN0cmluZ2lmeSIsInN1Y2Nlc3MiLCJyb3VuZCIsInJlc3VsdHMiLCJTdHJpbmciLCJyIiwiZXEiLCJmaW5kIiwiaCIsImFkZENsYXNzIiwic3JjIiwidG9EYXRhVVJMIiwiY2xpY2siXSwi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aUI3RSxHQUN0QixJQUFLLEdBQUlDLEdBQUksRUFBR0EsRUFBSSxFQUFHQSxJQUFLLENBQ3hCLElBQUssR0FBSUcsR0FBSSxFQUFHRSxFQUFJLEVBQUd1RCxFQUFJLEVBQUdBLEVBQUksR0FBSUEsSUFBSyxDQUN2QyxHQUFJRyxHQUFJSSxLQUFLVSxNQUFNLElBQU05RSxFQUFFK0UsUUFBUTlFLEdBQUc0RCxHQUN0Q0csR0FBSTVELElBQU1BLEVBQUk0RCxFQUFHMUQsRUFBSXVELEVBQ3JCLEtBQUssR0FBSUksR0FBSWUsT0FBT2hCLEdBQUczRCxPQUFRNkQsRUFBSSxFQUFHQSxFQUFJLEVBQUlELEVBQUdDLElBQzdDRixFQUFJLElBQU1BLENBQ2IsSUFBSWlCLEdBQUksS0FBT2pCLENBQ2hCQSxHQUFJLE1BQVFpQixFQUFJLFNBQVV4QyxFQUFFLGNBQWN5QyxHQUFHckIsRUFBSSxHQUFHc0IsS0FBSyxNQUFNRCxHQUFHakYsR0FBR3lDLEtBQUt1QyxHQUU5RSxJQUFLLEdBQUlHLEdBQUksRUFBR0EsRUFBSSxHQUFJQSxJQUNwQkEsSUFBTTlFLEVBQUltQyxFQUFFLGNBQWN5QyxHQUFHRSxFQUFJLEdBQUdELEtBQUssTUFBTUQsR0FBR2pGLEdBQUdvRixTQUFTLFdBQWE1QyxFQUFFLGNBQWN5QyxHQUFHRSxFQUFJLEdBQUdELEtBQUssTUFBTUQsR0FBR2pGLEdBQUcwQyxZQUFZLGdCQUtuSjFDLEVBQUVxRixJQUFNdkUsS0FBS0MsT0FBT3VFLGdCQUUxQnZGLElBRVR5QyxHQUFFLFdBQ0UsR0FBSXpDLEdBQUksR0FBSWMsS0FDWjJCLEdBQUUsVUFBVStDLE1BQU0sV0FDZHhGLEVBQUU2QiIsImZpbGUiOiJtYWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCI7XG5cbmZ1bmN0aW9uIF9jbGFzc0NhbGxDaGVjayh0LCBlKSB7XG4gICAgaWYgKCEodCBpbnN0YW5jZW9mIGUpKSB0aHJvdyBuZXcgVHlwZUVycm9yKFwiQ2Fubm90IGNhbGwgYSBjbGFzcyBhcyBhIGZ1bmN0aW9uXCIpO1xufVxudmFyIF9jcmVhdGVDbGFzcyA9IGZ1bmN0aW9uICgpIHtcbiAgICBmdW5jdGlvbiB0KHQsIGUpIHtcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBlLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICB2YXIgbiA9IGVbaV07XG4gICAgICAgICAgICBuLmVudW1lcmFibGUgPSBuLmVudW1lcmFibGUgfHwgITEsIG4uY29uZmlndXJhYmxlID0gITAsIFwidmFsdWVcIiBpbiBuICYmIChuLndyaXRhYmxlID0gITApLCBPYmplY3QuZGVmaW5lUHJvcGVydHkodCwgbi5rZXksIG4pO1xuICAgICAgICB9XG4gICAgfVxuICAgIHJldHVybiBmdW5jdGlvbiAoZSwgaSwgbikge1xuICAgICAgICByZXR1cm4gaSAmJiB0KGUucHJvdG90eXBlLCBpKSwgbiAmJiB0KGUsIG4pLCBlO1xuICAgIH07XG59KCksXG4gICAgTWFpbiA9IGZ1bmN0aW9uICgpIHtcbiAgICBmdW5jdGlvbiB0KCkge1xuICAgICAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgdCksIHRoaXMuY2FudmFzID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJtYWluXCIpLCB0aGlzLmlucHV0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJpbnB1dFwiKSwgdGhpcy5jYW52YXMud2lkdGggPSA0NDksIHRoaXMuY2FudmFzLmhlaWdodCA9IDQ0OSwgdGhpcy5jdHggPSB0aGlzLmNhbnZhcy5nZXRDb250ZXh0KFwiMmRcIiksIHRoaXMuY2FudmFzLmFkZEV2ZW50TGlzdGVuZXIoXCJtb3VzZWRvd25cIiwgdGhpcy5vbk1vdXNlRG93bi5iaW5kKHRoaXMpKSwgdGhpcy5jYW52YXMuYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNldXBcIiwgdGhpcy5vbk1vdXNlVXAuYmluZCh0aGlzKSksIHRoaXMuY2FudmFzLmFkZEV2ZW50TGlzdGVuZXIoXCJtb3VzZW1vdmVcIiwgdGhpcy5vbk1vdXNlTW92ZS5iaW5kKHRoaXMpKSwgdGhpcy5pbml0aWFsaXplKCk7XG4gICAgfVxuICAgIHJldHVybiBfY3JlYXRlQ2xhc3ModCwgW3tcbiAgICAgICAga2V5OiBcImluaXRpYWxpemVcIixcbiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIHZhbHVlKCkge1xuICAgICAgICAgICAgdGhpcy5jdHguZmlsbFN0eWxlID0gXCIjRkZGRkZGXCIsIHRoaXMuY3R4LmZpbGxSZWN0KDAsIDAsIDQ0OSwgNDQ5KSwgdGhpcy5jdHgubGluZVdpZHRoID0gMSwgdGhpcy5jdHguc3Ryb2tlUmVjdCgwLCAwLCA0NDksIDQ0OSksIHRoaXMuY3R4LmxpbmVXaWR0aCA9IC4wNTtcbiAgICAgICAgICAgIGZvciAodmFyIHQgPSAwOyB0IDwgMjc7IHQrKykge1xuICAgICAgICAgICAgICAgIHRoaXMuY3R4LmJlZ2luUGF0aCgpLCB0aGlzLmN0eC5tb3ZlVG8oMTYgKiAodCArIDEpLCAwKSwgdGhpcy5jdHgubGluZVRvKDE2ICogKHQgKyAxKSwgNDQ5KSwgdGhpcy5jdHguY2xvc2VQYXRoKCksIHRoaXMuY3R4LnN0cm9rZSgpLCB0aGlzLmN0eC5iZWdpblBhdGgoKSwgdGhpcy5jdHgubW92ZVRvKDAsIDE2ICogKHQgKyAxKSksIHRoaXMuY3R4LmxpbmVUbyg0NDksIDE2ICogKHQgKyAxKSksIHRoaXMuY3R4LmNsb3NlUGF0aCgpLCB0aGlzLmN0eC5zdHJva2UoKTtcbiAgICAgICAgICAgIH10aGlzLmRyYXdJbnB1dCgpLCAkKFwiI291dHB1dCB0ZFwiKS50ZXh0KFwiXCIpLnJlbW92ZUNsYXNzKFwic3VjY2Vzc1wiKTtcbiAgICAgICAgfVxuICAgIH0sIHtcbiAgICAgICAga2V5OiBcIm9uTW91c2VEb3duXCIsXG4gICAgICAgIHZhbHVlOiBmdW5jdGlvbiB2YWx1ZSh0KSB7XG4gICAgICAgICAgICB0aGlzLmNhbnZhcy5zdHlsZS5jdXJzb3IgPSBcImRlZmF1bHRcIiwgdGhpcy5kcmF3aW5nID0gITAsIHRoaXMucHJldiA9IHRoaXMuZ2V0UG9zaXRpb24odC5jbGllbnRYLCB0LmNsaWVudFkpO1xuICAgICAgICB9XG4gICAgfSwge1xuICAgICAgICBrZXk6IFwib25Nb3VzZVVwXCIsXG4gICAgICAgIHZhbHVlOiBmdW5jdGlvbiB2YWx1ZSgpIHtcbiAgICAgICAgICAgIHRoaXMuZHJhd2luZyA9ICExLCB0aGlzLmRyYXdJbnB1dCgpO1xuICAgICAgICB9XG4gICAgfSwge1xuICAgICAgICBrZXk6IFwib25Nb3VzZU1vdmVcIixcbiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIHZhbHVlKHQpIHtcbiAgICAgICAgICAgIGlmICh0aGlzLmRyYXdpbmcpIHtcbiAgICAgICAgICAgICAgICB2YXIgZSA9IHRoaXMuZ2V0UG9zaXRpb24odC5jbGllbnRYLCB0LmNsaWVudFkpO1xuICAgICAgICAgICAgICAgIHRoaXMuY3R4LmxpbmVXaWR0aCA9IDE2LCB0aGlzLmN0eC5saW5lQ2FwID0gXCJyb3VuZFwiLCB0aGlzLmN0eC5iZWdpblBhdGgoKSwgdGhpcy5jdHgubW92ZVRvKHRoaXMucHJldi54LCB0aGlzLnByZXYueSksIHRoaXMuY3R4LmxpbmVUbyhlLngsIGUueSksIHRoaXMuY3R4LnN0cm9rZSgpLCB0aGlzLmN0eC5jbG9zZVBhdGgoKSwgdGhpcy5wcmV2ID0gZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH0sIHtcbiAgICAgICAga2V5OiBcImdldFBvc2l0aW9uXCIsXG4gICAgICAgIHZhbHVlOiBmdW5jdGlvbiB2YWx1ZSh0LCBlKSB7XG4gICAgICAgICAgICB2YXIgaSA9IHRoaXMuY2FudmFzLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICB4OiB0IC0gaS5sZWZ0LFxuICAgICAgICAgICAgICAgIHk6IGUgLSBpLnRvcFxuICAgICAgICAgICAgfTtcbiAgICAgICAgfVxuICAgIH0sIHtcbiAgICAgICAga2V5OiBcImRyYXdJbnB1dFwiLFxuICAgICAgICB2YWx1ZTogZnVuY3Rpb24gdmFsdWUoKSB7XG4gICAgICAgICAgICB2YXIgdCA9IHRoaXMuaW5wdXQuZ2V0Q29udGV4dChcIjJkXCIpLFxuICAgICAgICAgICAgICAgIGUgPSBuZXcgSW1hZ2UoKTtcbiAgICAgICAgICAgIGUub25sb2FkID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHZhciBpID0gW10sXG4gICAgICAgICAgICAgICAgICAgIG4gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiY2FudmFzXCIpLmdldENvbnRleHQoXCIyZFwiKTtcbiAgICAgICAgICAgICAgICBuLmRyYXdJbWFnZShlLCAwLCAwLCBlLndpZHRoLCBlLmhlaWdodCwgMCwgMCwgMjgsIDI4KTtcbiAgICAgICAgICAgICAgICBmb3IgKHZhciBzID0gbi5nZXRJbWFnZURhdGEoMCwgMCwgMjgsIDI4KS5kYXRhLCBhID0gMDsgYSA8IDI4OyBhKyspIHtcbiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgbyA9IDA7IG8gPCAyODsgbysrKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgYyA9IDQgKiAoMjggKiBhICsgbyk7XG4gICAgICAgICAgICAgICAgICAgICAgICBpWzI4ICogYSArIG9dID0gKHNbYyArIDBdICsgc1tjICsgMV0gKyBzW2MgKyAyXSkgLyAzLCB0LmZpbGxTdHlsZSA9IFwicmdiKFwiICsgW3NbYyArIDBdLCBzW2MgKyAxXSwgc1tjICsgMl1dLmpvaW4oXCIsXCIpICsgXCIpXCIsIHQuZmlsbFJlY3QoNSAqIG8sIDUgKiBhLCA1LCA1KTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0yNTUgIT09IE1hdGgubWluLmFwcGx5KE1hdGgsIGkpICYmICQuYWpheCh7XG4gICAgICAgICAgICAgICAgICAgIHVybDogXCIvYXBpL21uaXN0XCIsXG4gICAgICAgICAgICAgICAgICAgIG1ldGhvZDogXCJQT1NUXCIsXG4gICAgICAgICAgICAgICAgICAgIGNvbnRlbnRUeXBlOiBcImFwcGxpY2F0aW9uL2pzb25cIixcbiAgICAgICAgICAgICAgICAgICAgZGF0YTogSlNPTi5zdHJpbmdpZnkoaSksXG4gICAgICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uIHN1Y2Nlc3ModCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgZSA9IDA7IGUgPCA0OyBlKyspIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMCwgbiA9IDAsIHMgPSAwOyBzIDwgMTA7IHMrKykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgYSA9IE1hdGgucm91bmQoMWUzICogdC5yZXN1bHRzW2VdW3NdKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYSA+IGkgJiYgKGkgPSBhLCBuID0gcyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAodmFyIG8gPSBTdHJpbmcoYSkubGVuZ3RoLCBjID0gMDsgYyA8IDMgLSBvOyBjKyspIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEgPSBcIjBcIiArIGE7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH12YXIgciA9IFwiMC5cIiArIGE7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEgPiA5OTkgJiYgKHIgPSBcIjEuMDAwXCIpLCAkKFwiI291dHB1dCB0clwiKS5lcShzICsgMSkuZmluZChcInRkXCIpLmVxKGUpLnRleHQocik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGggPSAwOyBoIDwgMTA7IGgrKykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBoID09PSBuID8gJChcIiNvdXRwdXQgdHJcIikuZXEoaCArIDEpLmZpbmQoXCJ0ZFwiKS5lcShlKS5hZGRDbGFzcyhcInN1Y2Nlc3NcIikgOiAkKFwiI291dHB1dCB0clwiKS5lcShoICsgMSkuZmluZChcInRkXCIpLmVxKGUpLnJlbW92ZUNsYXNzKFwic3VjY2Vzc1wiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0sIGUuc3JjID0gdGhpcy5jYW52YXMudG9EYXRhVVJMKCk7XG4gICAgICAgIH1cbiAgICB9XSksIHQ7XG59KCk7XG4kKGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgdCA9IG5ldyBNYWluKCk7XG4gICAgJChcIiNjbGVhclwiKS5jbGljayhmdW5jdGlvbiAoKSB7XG4gICAgICAgIHQuaW5pdGlhbGl6ZSgpO1xuICAgIH0pO1xufSk7Il19
